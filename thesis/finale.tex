\section{Proof of \Cref{thm:semi_lie_n_equals_2}}
\label{ch:finale}
We now put together all the results from the previous chapters to
prove \Cref{thm:semi_lie_n_equals_2}.

On the orbital side, we assume $\guv$ is as in \Cref{lem:semi_lie_params} throughout this chapter.
On the geometric side, we assume $(g,u)$ are as described in \Cref{sec:g_u_invariants}.

\subsection{Matching $\guv$ and $(g,u)$, and the invariants for the matching}
\subsubsection{The invariants for the orbit of $\guv$}
Recall the relations in \Cref{lem:semi_lie_params}.
The invariants in this case as described in \Cref{def:matching_semi_lie} are:
\begin{itemize}
  \ii $\Tr \gamma = a + d$
  \ii $\det \gamma = ad - bc$
  \ii $\vv^\top \uu = e$
  \ii $\vv^\top \gamma \uu = \begin{pmatrix} 0 & e \end{pmatrix}
  \begin{pmatrix} a & b \\ c & d \end{pmatrix} \begin{pmatrix} 0 \\ 1 \end{pmatrix} = de$.
\end{itemize}
Note that the parameters $b$ and $c$ are absent; but we have
\[ v(b) + v(c) = v(\det \gamma - a d). \]

\subsubsection{Matching}
We now take these results and line them up with \Cref{lem:g_u_invariants}
to deduce the following lemma.

\begin{lemma}
  [Explicit matching of invariants of $\U(\VV_2^-)$ and $(S_2(F) \times V'_2(F))\rs^-$]
  \label{lem:finale_match}
  Let
  \[ g = \lambda\inv \begin{pmatrix}
    \alpha & \bar\beta \varpi \\
    \beta & \bar\alpha
    \end{pmatrix} \in \U(\VV_2^-) \]
  and $u = s + t \Pi$ with $s t = 0$ and $v(\lambda) = 0$.
  Suppose $(g,u)$ matches with
  \[ (\gamma, \uu, \vv^\top) = \left( \begin{pmatrix} a & b \\ c & d \end{pmatrix},
    \begin{pmatrix} 0 \\ 1 \end{pmatrix}, \begin{pmatrix} 0 & e \end{pmatrix} \right)
    \in (S_2(F) \times V'_2(F))\rs. \]
  Then we have
  \begin{align*}
    a &= \begin{cases}
      \lambda\inv \bar\alpha & \text{if } s = 0 \\
      \lambda\inv \alpha & \text{if } t = 0 \\
    \end{cases} \\
    d &= \begin{cases}
      \lambda\inv \alpha & \text{if } s = 0 \\
      \lambda\inv \bar\alpha & \text{if } t = 0 \\
    \end{cases} \\
    bc &= \lambda^{-2} \beta \bar\beta \varpi \\
    e &= \Nm u.
  \end{align*}
  Thus we also have the identity
  \[ v(d - a) = v(\alpha_1). \]
\end{lemma}
\begin{proof}
  Setting the invariants from the previous subsection equal
  to the ones determined in \Cref{lem:g_u_invariants} gives
  \begin{align*}
    a + d &= \lambda\inv (\alpha + \bar\alpha) \\
    \det \gamma = ad - bc &= \det g = \lambda^{-2} (\alpha \bar\alpha - \beta \bar\beta \varpi) \\
    e &= \Nm u \\
    de &= \begin{cases}
      \lambda\inv \bar\alpha \Nm u & \text{if } s = 0 \\
      \lambda\inv \alpha \Nm u & \text{if } t = 0.
    \end{cases}
  \end{align*}
  So the equations for $e$, $d$ and $a$ are immediate.
  In both cases we get $ad = \lambda^{-2} \alpha \bar \alpha$ and hence
  \[ \lambda^{-2} \beta \bar \beta \varpi
    = -(\det g -  \lambda^{-2} \alpha \bar \alpha)
    = -(\det \gamma - ad) = bc. \qedhere \]
\end{proof}

\begin{remark}
  [Deriving \Cref{lem:semi_lie_params} from \Cref{lem:finale_match}]
  Note that many of the assumptions in \Cref{lem:semi_lie_params}
  can also be extracted from \Cref{lem:finale_match}.
  For example, taking the valuation of
  \[ \lambda \bar \lambda = \alpha \bar \alpha - \beta \bar \beta \varpi \]
  implies that (since the left-hand side is a unit)
  \[ v(a) = v(\alpha) = 0 <  2v(\beta) + 1 = v(b) + v(c). \]
  So indeed $v(1-a \bar a) = v(\bar bc)$ must be odd.
\end{remark}

\subsection{Translation of the Gross-Keating data to the orbital side}
We combine the results of \Cref{sec:GK} with \Cref{lem:finale_match}.
Retaining the notation
\begin{align*}
  x &\coloneqq \bar u \sqrt{\eps} u = (s \bar s + t \bar t \varpi) \sqrt{\eps} \in \ODT \\
  y &\coloneqq (g \cdot \varpi^r)_- = (\alpha_1\sqrt\eps + \beta \Pi) \in \ODT
\end{align*}
from \Cref{sec:GK}, we obtain the following:
\begin{align*}
  v(\left\langle x,x \right\rangle _0)
    &= 2 v(\Nm u) \\
    &= 2v(e) \\
  v\left( \left\langle x,y \right\rangle _0 \right)
    &= r + v(\alpha_1) + v(\Nm u) \\
    &= r + v(d-a) + v(e) \\
  v(
    \left\langle x,x \right\rangle _0 \left\langle y,y \right\rangle _0
    - \left\langle x,y \right\rangle^2_0
  )
    &= 2r + 2 v(\Nm u) + v(\beta \bar\beta \varpi) \\
    &= 2r + 2v(e) + v(b) + v(c).
\end{align*}
Notice that the last valuation is odd.
Therefore we can always extract $v(\left\langle y,y \right\rangle _0)$ by writing
\begin{align*}
  v\left(\left\langle x,x \right\rangle _0\right) + v\left(\left\langle y,y \right\rangle _0\right)
  &= \min \left( v\left( \left\langle x,x \right\rangle _0 \left\langle y,y \right\rangle _0 - \left\langle x,y \right\rangle^2_0 \right),
    v(\left\langle x,y \right\rangle^2_0) \right) \\
  \implies  v\left(\left\langle y,y \right\rangle _0\right)
  &= \min(2r + 2v(e) + v(b) + v(c), 2r + 2v(d-a) + 2v(e)) - 2v(e) \\
  &= 2r + \min(v(b) + v(c), 2v(d-a)).
\end{align*}
Hence, we have
\begin{align*}
  &\phantom= \min\left(
    v(\left\langle x,x \right\rangle _0),
    v(\left\langle x,y \right\rangle _0),
    v(\left\langle y,y \right\rangle _0),
  \right) \\
  &= \min\left( 2v(e), r+v(d-a)+v(e), 2r+\min(v(b)+v(c), 2v(\varsigma)) \right) \\
  &= \min\left( 2v(e), r+v(d-a)+v(e), 2r+v(b)+v(c), 2r+2v(\varsigma) \right) \\
  &= \min\left( 2v(e), v(b)+v(c)+2r, 2v(d-a)+2r \right)
\end{align*}
where we can drop $r+v(d-a)+v(e)$ from the minimum because it equals
$\frac{2v(e) + (2v(d-a)+2r)}{2}$.

Now recall the right-hand side of \Cref{prop:GK}, that is
\[
  \begin{cases}
    \sum_{j=0}^{\frac{n_1-1}{2}} (n_1+n_2-4j) \cdot q^j & \text{if } n_1 \equiv 1 \pmod 2 \\
    \frac{n_2-n_1+1}{2} q^{n_1/2} + \sum_{j=0}^{n_1/2-1} (n_1+n_2-4j) \cdot q^j & \text{if } n_1 \equiv 0 \pmod 2.
  \end{cases}
\]
for $0 \le n_1 \le n_2$.
Then apply \Cref{prop:GK} to obtain that
\[
  \left< \ZO4(1), \;
    \ZO4(\bar u \sqrt{\eps} u), \;
    \ZO4((g \cdot \varpi^r)_-) \right>_{\MM_2 \times \MM_2}
\]
is equal to the above formula applied at
\begin{align*}
  n_1 &\coloneqq \min(2v(e), v(b)+v(c)+2r, 2v(d-a)+2r) \\
  n_2 &\coloneqq 2v(e) + v(b) + v(c) + 2r - n_1.
\end{align*}
Note that
\[ n_1 + n_2 = 2v(e) + v(b) + v(c) + 2r. \]
For brevity, we henceforth introduce the symbol $\GK$ for the sum above;
hence we have
\begin{equation}
  \ifthesis
  \left< \ZO4(1), \; \ZO4(\bar u \sqrt{\eps} u), \; \ZO4((g \cdot \varpi^r)_-) \right>_{\MM_2 \times \MM_2}
    = \GK(r, v(b), v(c), v(e), v(d-a)).
  \fi
  \ifpaper
  \begin{aligned}
    &\GK(r, v(b), v(c), v(e), v(d-a)) \\
    &= \left< \ZO4(1), \; \ZO4(\bar u \sqrt{\eps} u), \; \ZO4((g \cdot \varpi^r)_-) \right>_{\MM_2 \times \MM_2}.
  \end{aligned}
  \fi
  \label{eq:GKdef}
\end{equation}

In that case we also have
\ifthesis
\[
  \left< \ZO4(1), \;
    \ZO4\left(\frac{\bar u \sqrt{\eps} u}{\varpi}\right), \;
    \ZO4((g \cdot \varpi^r)_-) \right>_{\MM_2 \times \MM_2}
    = \GK(r, v(b), v(c), v(e)-1, v(d-a)). \]
\fi
\ifpaper
\begin{align*}
  &\GK(r, v(b), v(c), v(e)-1, v(d-a)) \\
  &= \left< \ZO4(1), \;
    \ZO4\left(\frac{\bar u \sqrt{\eps} u}{\varpi}\right), \;
    \ZO4((g \cdot \varpi^r)_-) \right>_{\MM_2 \times \MM_2}.
\end{align*}
\fi
Subtracting the two gives
\begin{equation}
  \begin{aligned}
    \Int^\circ((g,u), \fr) &=
      \left< \ZO4(1), \;
        \ZO4(\bar u \sqrt{\eps} u)^\circ, \;
        \ZO4((g \cdot \varpi^r)_-) \right>_{\MM_2 \times \MM_2} \\
    &= \GK(r, v(b), v(c), v(e), v(d-a)) \\
    &\qquad- \GK(r, v(b), v(c), v(e)-1, v(d-a)).
  \end{aligned}
  \label{eq:int_subtract}
\end{equation}

\subsection{Base change}
\label{sec:finale_base_change}
The base change for $n=2$ was already calculated in \cite{ref:AFLspherical}
and we simply recall the result here.

As in \Cref{ch:jiao}, we define
\begin{align*}
  \fr &\coloneqq \mathbf{1}_{\varpi^{-r} \Mat_2(\OO_E) \cap \U(\VV_n^+)} \in \HH(\U(\VV_n^+)) \\
  \mathbf{1}_{K, r} &\coloneqq \fr - \mathbf{1}_{K, \le (r-1)} \\
  &= \mathbf{1}_{\varpi^{-r} \Mat_2(\OO_E) \cap \U(\VV_n^+)} \in \HH(\U(\VV_n^+)) \\
\end{align*}

\begin{lemma}
  [{\cite[Lemma 7.1.1]{ref:AFLspherical}}]
  \label{lem:finale_base_change}
  For $n = 2$ and $r \ge 1$ we have
  \begin{align*}
    \BC_S^{\eta}(
      \mathbf{1}_{K'_{S, \le r}}
      + \mathbf{1}_{K'_{S, \le (r-1)}}
      )
      &= (-1)^r \mathbf{1}_{K, r} \\
      &= (-1)^r(\mathbf{1}_{K, \le r} - \mathbf{1}_{K, \le (r-1)}).
  \end{align*}
\end{lemma}
\begin{proof}
  This follows directly from \cite[Equation (7.1.9)]{ref:AFLspherical}.
\end{proof}

\subsection{Transfer factor}
As stated in \eqref{eq:semi_lie_transfer}, the transfer factor is
\[ \omega\guv = (-1)^{v(c)+1}. \]

\subsection{Comparison to orbital formula}
In what follows, we introduce the shorthand
\[ \partial\Orb(r, v(b), v(c), v(e), v(d-a))
  \coloneqq \partial \Orb(\guv, \mathbf{1}_{K'_{S, \le r}}). \]
The main claim is that the following formula holds:
\begin{theorem}
  [$\GK$ is a difference of two orbitals]
  \label{thm:miracle}
  We have
  \begin{align*}
    \ifthesis
    &\frac{(-1)^{r+v(c)}}{\log q}\Big(\partial\Orb(r, v(b), v(c), v(e), v(d-a))
      + \partial\Orb(r, v(b), v(c), v(e)-1, v(d-a))\Big) \\
    \fi
    \ifpaper
    \frac{(-1)^{r+v(c)}}{\log q}\Big(&\partial\Orb(r, v(b), v(c), v(e), v(d-a)) \\
    &+ \partial\Orb(r, v(b), v(c), v(e)-1, v(d-a))\Big) \\
    \fi
    &= \GK(r, v(b), v(c), v(e), v(d-a)).
  \end{align*}
\end{theorem}

We continue to use the notation $N$ and $\varkappa$ from \Cref{ch:orbitalFJ2} defined by
\begin{align*}
  N &\coloneqq \min \left( v(e),
    \tfrac{v(b)+v(c)-1}{2} + r, v(d-a) + r \right) \\
  \varkappa &\coloneqq v(e) - v(d-a) - r \ge 0
\end{align*}
and prove \Cref{thm:miracle} by exhausting the
cases based on which value of $N$ is smallest.

\subsubsection{Proof of \Cref{thm:miracle}
  when $v(e) \le \tfrac{v(b)+v(c)-1}{2} + r$
  and $v(e) \le v(d-a) + r$}
In the Gross-Keating formula we have simply
\begin{align*}
  n_1 &= 2v(e) \\
  n_2 &= v(b) + v(c) + 2r.
\end{align*}
Hence, we have
\begin{align*}
  \GK(r, v(b), v(c), v(e), v(d-a))
  &= \frac{-2v(e)+v(b)+v(c)+2r+1}{2} q^{v(e)} \\
  &\qquad+ \sum_{j=0}^{v(e)-1} (2v(e)+v(b)+v(c)+2r-4j) \cdot q^j.
\end{align*}
On the orbital side, we refer to \Cref{cor:semi_lie_derivative_single}
and compare it to the single instance of Gross-Keating above.
The exponent of $j$ runs up to $v(e)$ in one case and $v(e)-1$ in the second;
that is we need
\begin{align*}
  &\phantom= \sum_{j=0}^{v(e)} \left( \frac{2v(e)+v(b)+v(c)+1}{2} + r - 2j \right) \cdot q^j \\
  &\qquad+ \sum_{j=0}^{v(e)-1} \left( \frac{2(v(e)-1)+v(b)+v(c)+1}{2} + r - 2j \right) \cdot q^j \\
  &= \frac{-2v(e)+v(b)+v(c)+2r+1}{2} q^{v(e)}
  + \sum_{j=0}^{v(e)-1} (2v(e)+v(b)+v(c)+2r-4j) \cdot q^j
\end{align*}
which is obvious.

\subsubsection{Proof of \Cref{thm:miracle}
  when $\tfrac{v(b)+v(c)-1}{2} + r < v(e)$
  and $v(b)+v(c) < 2v(d-a)$}

Set $N = \frac{v(b)+v(c)-1}{2} + r$.
In the Gross-Keating formula we have simply
\begin{align*}
  n_1 &= 2N+1 \\
  n_2 &= 2v(e).
\end{align*}
Hence
\[ \GK(r, v(b), v(c), v(e), v(d-a))
  = \sum_{j=0}^N (2v(e)+v(b)+v(c)+2r-4j) \cdot q^j. \]
We compare this to \Cref{cor:semi_lie_derivative_single}; we check
\begin{align*}
  &\phantom= \sum_{j=0}^{N} \left( \frac{2v(e)+v(b)+v(c)+1}{2} + r - 2j \right) \cdot q^j \\
  &\qquad+ \sum_{j=0}^{N} \left( \frac{2(v(e)-1)+v(b)+v(c)+1}{2} + r - 2j \right) \cdot q^j \\
  &= \sum_{j=0}^N (2v(e)+v(b)+v(c)+2r-4j) \cdot q^j
\end{align*}
which is clear.

\subsubsection{Proof of \Cref{thm:miracle}
  when $v(d-a)+r < v(e)$ and $2v(d-a) < v(b)+v(c)$}
Hence $N = v(d-a) + r$ and $\varkappa \coloneqq v(e) - (v(d-a)+r) > 0$.
In the Gross-Keating side formula, we now have
\begin{align*}
  n_1 &\coloneqq 2v(d-a) + 2r = 2N \\
  n_2 &= 2v(e) + v(b) + v(c) - 2v(d-a).
\end{align*}
Hence
\begin{align*}
  \GK(r, v(b), v(c), v(e), v(d-a))
  &= \frac{2v(e)+v(b)+v(c)-4v(d-a)-2r+1}{2} q^{N} \\
    &\qquad+ \sum_{j=0}^{N-1} (2v(e)+v(b)+v(c)+2r-4j) \cdot q^j.
\end{align*}
This time, the relevant combination of \Cref{cor:semi_lie_derivative_single} is
\begin{align*}
  &\phantom= \sum_{j=0}^N q^j
  \cdot \left( \frac{2v(e)+v(b)+v(c)+1}{2} + r - 2j \right) \\
  &\qquad + q^{N} \cdot
  \begin{cases}
    -\frac{\varkappa}{2} & \text{if }\varkappa \equiv 0 \pmod 2 \\
    \frac{\varkappa}{2} - \left( v(e)+\frac{v(b)+v(c)}{2}-2v(d-a)-r \right)
    & \text{if }\varkappa \equiv 1 \pmod 2
  \end{cases} \\
  &\qquad + \sum_{j=0}^N q^j
  \cdot \left( \frac{2(v(e)-1)+v(b)+v(c)+1}{2} + r - 2j \right) \\
  &\qquad + q^{N} \cdot
  \begin{cases}
    -\frac{\varkappa-1}{2} & \text{if }\varkappa-1 \equiv 0 \pmod 2 \\
    \frac{\varkappa-1}{2} - \left( (v(e)-1)+\frac{v(b)+v(c)}{2}-2v(d-a)-r \right)
    & \text{if }\varkappa-1 \equiv 1 \pmod 2 \\
  \end{cases} \\
  &= \sum_{j=0}^N q^j
  \cdot \left( 2v(e)+v(b)+v(c) + 2r - 4j \right) \cdot q^j \\
  &\qquad + q^{N} \cdot
  \begin{cases}
    -\frac{\varkappa}{2} + \frac{\varkappa-1}{2} - \left( (v(e)-1) +\frac{v(b)+v(c)}{2}-2v(d-a)-r \right)
    & \text{if }\varkappa \equiv 0 \pmod 2 \\
    -\frac{\varkappa-1}{2} + \frac{\varkappa}{2} - \left( v(e)+\frac{v(b)+v(c)}{2}-2v(d-a)-r \right)
    & \text{if }\varkappa \equiv 1 \pmod 2 \\
  \end{cases} \\
  &= \sum_{j=0}^N q^j
  \cdot \left( 2v(e)+v(b)+v(c) + 2r - 4j \right) \cdot q^j \\
  &\qquad + q^{N} \cdot
    \left( \half - \left( v(e)+\frac{v(b)+v(c)}{2}-2v(d-a)-r \right) \right) \\
  &= \sum_{j=0}^{N-1} q^j
  \cdot \left( 2v(e)+v(b)+v(c) + 2r - 4j \right) \cdot q^j \\
  &\qquad + q^{N} \cdot
    \left( \left( 2v(e)+v(b)+v(c) + 2r - 4N \right) +
    \half - \left( v(e)+\frac{v(b)+v(c)}{2}-2v(d-a)-r \right) \right).
\end{align*}
The coefficient of $q^N$ is given by
\begin{align*}
  &\phantom= \left( 2v(e)+v(b)+v(c) + 2r - 4(v(d-a)-r) \right) +
  \half - \left( v(e)+\frac{v(b)+v(c)}{2}-2v(d-a)-r \right) \\
  &= \frac{2v(e)+v(b)+v(c)-4v(d-a)-2r+1}{2}
\end{align*}
which matches the one from Gross-Keating.
Hence \Cref{thm:miracle} is completely proved.

\subsection{Conclusion (proof of \Cref{thm:semi_lie_n_equals_2})}
From \Cref{thm:miracle} we have
\begin{align*}
  \GK(r, v(b), v(c), v(e), v(d-a))
  &= \frac{(-1)^{r+v(c)}}{\log q} \Big(
      \partial \Orb(r, v(b), v(c), v(e), v(d-a)) \\
      &\qquad + \partial \Orb(r, v(b), v(c), v(e)-1, v(d-a))
    \Big) \\
  \GK(r, v(b), v(c), v(e)-1, v(d-a))
  &= \frac{(-1)^{r+v(c)}}{\log q} \Big(
      \partial \Orb(r, v(b), v(c), v(e)-1, v(d-a)) \\
      &\qquad + \partial \Orb(r, v(b), v(c), v(e)-2, v(d-a))
    \Big)
\end{align*}
so subtraction (and recalling \eqref{eq:int_subtract}) gives
\begin{equation}
  \begin{aligned}
    \Int^\circ((g,u), \fr)
    &= \GK(r, v(b), v(c), v(e), v(d-a)) \\
    &\qquad- \GK(r, v(b), v(c), v(e)-1, v(d-a)) \\
    &= \frac{(-1)^{r+v(c)}}{\log q} \Big(
        \partial \Orb(r, v(b), v(c), v(e), v(d-a)) \\
        &\qquad- \partial \Orb(r, v(b), v(c), v(e)-2, v(d-a))
      \Big).
  \end{aligned}
  \label{eq:descent_by_two}
\end{equation}
We now show that \eqref{eq:descent_by_two} implies \Cref{thm:semi_lie_n_equals_2}.
Because $r = 0$ is known already, it suffices to verify for $r > 0$.

Suppose we sum \eqref{eq:descent_by_two} with $u$ replaced by
$u/\varpi^i$ for $i = 0, 1, \dots$.
The left-hand side equals $\Int((g,u), \fr)$ by \eqref{eq:int_to_int_circ}.
On the right-hand side this has the effect of decreasing $v(e)$ by $2$ since $e = \Nm u$.
Hence the sum of the right-hand sides telescopes and gives us the identity
\begin{equation}
  \Int((g,u), \mathbf{1}_{K, \le r})
  = \frac{(-1)^{v(c)+r}}{\log q}
    \partial\Orb(\guv, \mathbf{1}_{K'_{S, \le r}}).
  \label{eq:match_penultimate}
\end{equation}
Subtracting the same equation from itself with $r$ replaced by $r-1$ gives
\begin{align*}
  &\Int((g,u), \mathbf{1}_{K, \le r} - \mathbf{1}_{K, \le (r-1)}) \\
  &= \frac{(-1)^{v(c)+r}}{\log q}
    \partial \Orb(\guv, \mathbf{1}_{K'_{S, \le r}} + \mathbf{1}_{K'_{S, \le (r-1)}}).
\end{align*}
which, since $(-1)^{v(c)} = -\omega\guv$, becomes
\begin{equation}
  \begin{aligned}
    &\Int((g,u), (-1)^r(\mathbf{1}_{K, \le r} - \mathbf{1}_{K, \le (r-1)})) \\
    &= \frac{-\omega\guv}{\log q}
    \partial \Orb(\guv, \mathbf{1}_{K'_{S, \le r}} + \mathbf{1}_{K'_{S, \le (r-1)}}).
  \end{aligned}
  \label{eq:match_final}
\end{equation}
But \Cref{lem:finale_base_change} says that
$(-1)^r(\mathbf{1}_{K, \le r} - \mathbf{1}_{K, \le (r-1)}) \in \HH(\U(\VV_n^+))$
matches $\mathbf{1}_{K'_{S, \le r}} + \mathbf{1}_{K'_{S, \le (r-1)}} \in \HH(S_2(F))$
for any $r \ge 0$.
And hence from the $r = 0$ case we can inductively conclude
\Cref{thm:semi_lie_n_equals_2} for $r > 0$, completing the proof.

\subsection{A particularly clean formula for a certain intersection number}
We mention in particular that the value of
\[ \Int^\circ((g,u), 1_{K,r})
  = \Big\langle \mathbb{T}_{\mathbf{1}_K \otimes \mathbf{1}_{K, r}}
    \Delta_{\ZD(u)^\circ}, \Gamma_g \Big\rangle_{\RZ_{2,2}} \]
(note the change from $\fr$ to $\mathbf{1}_{K, r}$ here)
has a particularly clean formula that seems worth mentioning.
We phrase this entirely based on the quantities in the geometric side to keep in self-contained.

\begin{theorem}
  [$\Int^\circ((g,u), 1_{K,r})$]
  \label{thm:clean_intersection}
  Let $r \ge 1$ and $v(\Nm u) > 0$ for $u \in \VV_2^-$, and let
  \[ g = \lambda^{-1}
    \begin{pmatrix} \alpha & \bar\beta \varpi \\ \beta & \bar\alpha \end{pmatrix}
    \in \U(\VV_2^-) \]
  where $v(\lambda) = 0$.
  Then
  \[ \Big\langle \mathbb{T}_{\mathbf{1}_K \otimes \mathbf{1}_{K, r}}
    \Delta_{\ZD(u)^\circ}, \Gamma_g \Big\rangle_{\RZ_{2,2}} \]
  is equal to
  \[
    \begin{cases}
      (C+1) q^{N} + (C+2) q^{N-1}
        & \text{if } v(\Nm u)-r = v(\alpha - \bar\alpha) \le v(\beta) \\
      2q^N & \text{if } v(\beta) + r < \min(v(\Nm u), v(\alpha - \bar\alpha) + r) \\
      q^N + q^{N-1} & \text{otherwise}
    \end{cases}
  \]
  where
  \[ N = \min(v(\Nm u), v(\beta) + r, v(\alpha-\bar\alpha) + r) \]
  and we write
  \[ C = v(\beta) - v(\alpha - \bar\alpha) \ge 0 \]
  in the first case.
\end{theorem}

\begin{proof}
  Recall that
  \begin{align*}
    \ifpaper
    &
    \fi
    \GK(r, v(b), v(c), v(e), v(d-a))
    \ifpaper
    \\
    \fi
    &= \frac{(-1)^{r+v(c)}}{\log q} \Big(
      \partial \Orb(r, v(b), v(c), v(e), v(d-a)) \\
      &\qquad+ \partial \Orb(r, v(b), v(c), v(e)-1, v(d-a))
      \Big) \\
    \ifpaper
    &
    \fi
    \GK(r-1, v(b), v(c), v(e), v(d-a))
    \ifpaper
    \\
    \fi
    &= \frac{(-1)^{r-1+v(c)}}{\log q} \Big(
      \partial \Orb(r-1, v(b), v(c), v(e), v(d-a)) \\
      &\qquad- \partial \Orb(r-1, v(b), v(c), v(e)-1, v(d-a))
      \Big)
  \end{align*}
  when we subtract we obtain that
  \begin{align*}
    \Int^\circ((g,u), \mathbf{1}_{K, r})
    &= \frac{(-1)^{r+v(c)}}{\log q} \Big(
      \partial \Orb(r, v(b), v(c), v(e), v(d-a)) \\
      &\qquad+ \partial \Orb(r-1, v(b), v(c), v(e), v(d-a)) \\
      &\qquad- \partial \Orb(r, v(b), v(c), v(e)-2, v(d-a)) \\
      &\qquad+ \partial \Orb(r-1, v(b), v(c), v(e)-2, v(d-a))
    \Big).
  \end{align*}
  Gathering the first two terms lets us apply the simpler formula \Cref{cor:semi_lie_combo} twice;
  doing so gives
  \begin{align*}
    \Int^\circ((g,u), \mathbf{1}_{K, r})
    &= \left( (q^N + q^{N-1} + \dots + 1) + C q^N + C' q^{N-1} \right) \\
    &- \left( (q^{N^\flat} + q^{N^\flat-1} + \dots + 1) + C^\flat q^{N^\flat} + (C')^\flat q^{N^\flat-1} \right)
  \end{align*}
  where $N$, $C$, $C'$ are is in \Cref{cor:semi_lie_combo},
  and $N^\flat$, $C^\flat$, $(C')^\flat$ are the same quantities
  with $v(e)$ replaced by $v(e)-2$.
  Let $\varkappa$ and $\varkappa^\flat = \varkappa - 2$ be also as in \Cref{cor:semi_lie_combo}.

  We consider cases now.
  \begin{itemize}
    \ii Suppose first $v(e) \le \frac{v(b)+v(c)-1}{2}+r$ and $v(e) < v(d-a)+r$.
    Then $N = v(e)$ and $N^\flat = v(e) - 2$ and $C = C' = (C^\flat) = (C')^\flat = 0$,
    Hence in this case we have
    \[ \Int^\circ((g,u), \mathbf{1}_{K, r}) = q^{N} + q^{N-1}. \]

    \ii Next suppose $2v(d-a) > v(b) + v(c)$ and consider cases on $v(e)$.
    We only need to consider $v(e) > \frac{v(b)+v(c)-1}{2} + r$.
    \begin{itemize}
      \ii If $v(e) = \frac{v(b)+v(c)-1}{2} + r + 1$
      then we have
      \[ N = \frac{v(b)+v(c)-1}{2} + r, \qquad N^\flat = \frac{v(b)+v(c)-1}{2} + r - 1 \]
      and
      $C = 1$, $C^\flat = 0$, and $C' = (C')^\flat = 0$.
      Consequently we get
      \[ \Int^\circ((g,u), \mathbf{1}_{K, r}) = 2 q^N. \]

      \ii Once $v(e) \ge \frac{v(b)+v(c)-1}{2} + r + 2$
      we always have $N = N^\flat = \frac{v(b)+v(c)-1}{2} + r$,
      \[ C - C^\flat = (v(e)-N)-((v(e)-2)-N) = 2 \]
      and $C' = (C')^\flat = 0$.
      Hence in this case we have
      \[ \Int^\circ((g,u), \mathbf{1}_{K, r}) = 2 q^N \]
      as well.
    \end{itemize}

    \ii Finally suppose $2v(d-a) < v(b) + v(c)$ and consider cases on $v(e)$.
    We only need to consider $v(e) \ge v(d-a) + r$.
    \begin{itemize}
      \ii If $v(e) = v(d-a) + r$,
      then \[ N = v(d-a) + r, \qquad N^\flat = v(d-a) + r - 2. \]
      In this case $\varkappa = 0$ (and $\varkappa^\flat=-2$).
      So $C^\flat = (C')^\flat = 0$ but we have larger terms
      \begin{align*}
        C &= \frac{v(b) + v(c)- 2v(d-a) - 1}{2} \\
        C' &= \frac{v(b) + v(c)- 2v(d-a) + 1}{2}.
      \end{align*}
      Hence, we get an exceptional case
      \begin{align*}
        \Int^\circ((g,u), \mathbf{1}_{K, r})
        &= \frac{v(b) + v(c) - 2v(d-a) + 1}{2} q^{N} \\
        &\qquad+ \frac{v(b) + v(c) - 2v(d-a) + 3}{2} q^{N-1}
      \end{align*}

      \ii If $v(e) = v(d-a) + r + 1$,
      then we have
      \[ N = v(d-a) + r, \qquad N^\flat = v(d-a) + r - 1. \]
      In this case $\varkappa = 1$ (and $\varkappa^\flat=-1$) so we have
      $C = 0$, $C' = 1$, $C^\flat = 0 = (C')^\flat = 0$.
      Consequently we get
      \[ \Int^\circ((g,u), \mathbf{1}_{K, r}) = q^{N} + q^{N-1}. \]

      \ii Once $v(e) \ge v(d-a) + r + 2$,
      we always have $N = N^\flat = v(d-a) + r$ and
      \[ C - C^\flat = (C') - (C'^\flat) = 1 \]
      regardless of the parity of $\varkappa$.
      Hence in this case we also get
      \[ \Int^\circ((g,u), \mathbf{1}_{K, r}) = q^{N} + q^{N-1}. \]
    \end{itemize}
  \end{itemize}
  Hence, in summary we get that
  \begin{equation}
  \begin{aligned}
    &\Int^\circ((g,u), \mathbf{1}_{K, r}) \\
    &= \begin{cases}
      (C+1) q^{N} + (C+2) q^{N-1}
        & \text{if } v(e)-r = v(d-a) \le \frac{v(b)+v(c)-1}{2} \\
      2q^N & \text{if } \frac{v(b)+v(c)-1}{2} + r < \min(v(e), v(d-a)+r) \\
      q^N + q^{N-1} & \text{otherwise}.
    \end{cases}
  \end{aligned}
  \label{eq:int_circle_orbital_param}
  \end{equation}
  where
  \[ C = \frac{v(b) + v(c)- 2v(d-a) - 1}{2} \ge 0 \]
  in the first case.
  Then \eqref{eq:int_circle_orbital_param} translates via
  \Cref{lem:finale_match} into the desired claim.
\end{proof}
